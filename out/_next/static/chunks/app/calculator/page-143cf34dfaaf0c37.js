(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[179],{98528:(e,t,i)=>{Promise.resolve().then(i.bind(i,46619))},46619:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Y});var n=i(57437),r=i(2265);let s=e=>(0,n.jsx)(n.Fragment,{children:e.children});var l=i(57818),a=i(23073),o=i.n(a),c=i(85984),d=i(24792),u=i(22960),h=i(35510),x=i(76548);let m=e=>{let t=(0,u.Z)();return(0,n.jsx)(h.Z,{variant:"progress",steps:e.totalSteps,position:"static",activeStep:e.activeStep,nextButton:(0,n.jsxs)(x.Z,{size:"small",onClick:e.handleNext,disabled:e.activeStep>=e.totalSteps-1,children:["PR\xd3XIMO","rtl"===t.direction?(0,n.jsx)(c.Z,{}):(0,n.jsx)(d.Z,{})]}),backButton:(0,n.jsxs)(x.Z,{size:"small",onClick:e.handleBack,disabled:0===e.activeStep,children:["rtl"===t.direction?(0,n.jsx)(d.Z,{}):(0,n.jsx)(c.Z,{}),"VOLTAR"]})})};var j=i(56007),p=i(69024),Z=i(66858),g=i(92434),v=i(88644),f=i(37590),I=i(79622),D=i(91651),b=i(10437),y=i(31655),C=i(60335),S=i(80511),w=i(68165),z=i(87913),F=i(33657);let k=e=>{let t=JSON.stringify(e),i=document.createElement("a");i.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),i.setAttribute("download","calculadora.json"),i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)},N=async e=>{var t;if(!(null===(t=e.target.files)||void 0===t?void 0:t.length))return{};let i=e.target.files[0];return"application/json"!=i.type?{errorMessage:"Ficheiro inv\xe1lido"}:{data:await new Response(i).json()}};var E=i(70152),U=i(78356);let M=e=>{let{group:t}=e,{setInput:i,getInput:s,errors:l,inputGroups:a,deleteInput:o}=(0,j.P)(e=>e),[c,d]=(0,r.useState)(t.Fields),[u,h]=(0,r.useState)([]),m=(e,n)=>{1===e.Units.length?i(t.ID,{id:e.ID,value:n,unit:e.Units[0].Unit}):i(t.ID,{id:e.ID,value:n})},p=e=>{let i=t.Fields.find(t=>t.ID===e);i&&(d(c.filter(t=>t.ID!==e)),h([...u,i]))},N=r.useCallback(e=>{let i=t.Fields.filter(t=>e.some(e=>e===t.ID));i.length&&(d(c.filter(t=>!e.some(e=>e===t.ID))),h([...u,...i]))},[t.Fields,c,u]),M=e=>{let t=u.filter(t=>t.ID!==e.ID);o(Number(e.ID)),h(t),d([...c,e])},R=(e,r)=>{var s;if(0===e.Units.length)return;let a=e.MultiField?3:4;return 1===e.Units.length?(0,n.jsx)(Z.Z,{label:"Unidade",value:e.Units[0].Unit,disabled:!0}):(0,n.jsx)(g.Z,{size:{xs:a,md:a},children:(0,n.jsxs)(v.Z,{error:l.some(t=>t.id==="".concat(e.ID,"_un")),required:e.Required,fullWidth:!0,children:[(0,n.jsx)(f.Z,{id:"combo-unit-".concat(e.ID),children:"Unidade"}),(0,n.jsxs)(I.Z,{labelId:"combo-unit-".concat(e.ID),id:"combo-unit-".concat(e.ID,"-label"),value:r.unit,onChange:n=>i(t.ID,{id:e.ID,value:r.value,unit:n.target.value}),fullWidth:!0,children:[(0,n.jsx)(D.Z,{value:"empty",children:"\xa0"},""),e.Units.map(e=>(0,n.jsx)(D.Z,{value:e.Unit,children:e.Unit},e.Unit))]}),(0,n.jsx)(b.Z,{children:null===(s=l.find(t=>t.id==="".concat(e.ID,"_un")))||void 0===s?void 0:s.message})]})})},P=e=>{var r;let a=s(e.ID);if(!a)return(0,n.jsx)(n.Fragment,{});let o=e.Units.length>0?8:a.customValue?11:12;return(0,n.jsxs)(g.Z,{size:{xs:12,md:12},container:!0,spacing:1,children:[(0,n.jsx)(g.Z,{size:{xs:o,md:o},children:(0,n.jsx)(y.Z,{title:e.Desc,arrow:!0,children:(0,n.jsx)(Z.Z,{fullWidth:!0,label:e.Name,required:e.Required,onChange:t=>m(e,t.target.value),error:l.some(t=>t.id===e.ID.toString()),helperText:null===(r=l.find(t=>t.id===e.ID.toString()))||void 0===r?void 0:r.message,value:a.value})})}),e.Units.length>0?(0,n.jsxs)(n.Fragment,{children:[R(e,a),e.MultiField?(0,n.jsx)(g.Z,{size:{xs:1,md:1},alignContent:"center",children:(0,n.jsx)(C.Z,{"aria-label":"delete",onClick:()=>M(e),title:"Remover",children:(0,n.jsx)(F.Z,{})})}):void 0]}):void 0,a.customValue?(0,n.jsx)(y.Z,{title:"Cancelar edi\xe7\xe3o",placement:"top",children:(0,n.jsx)(C.Z,{size:"large",onClick:()=>i(t.ID,{id:e.ID,value:"",customValue:!1}),children:(0,n.jsx)(U.Z,{})})}):null]})},V=e=>{var r;let a=s(e.ID);if(!a)return(0,n.jsx)(n.Fragment,{});let o=e.Values.map(e=>(0,n.jsx)(D.Z,{value:e,children:e},e));if(e.CustomValue){let e=(0,n.jsx)(D.Z,{value:"other",children:"Outro"},"other");o.push(e)}return(0,n.jsxs)(v.Z,{sx:{minWidth:"50%"},error:l.some(t=>t.id===e.ID.toString()),required:e.Required,children:[(0,n.jsx)(f.Z,{id:"combo-".concat(e.ID),children:e.Name}),(0,n.jsx)(y.Z,{title:e.Desc,arrow:!0,children:(0,n.jsx)(I.Z,{labelId:"combo-".concat(e.ID),id:"combo-".concat(e.ID,"-label"),value:a.value,onChange:n=>{let r=n.target.value,s="other"===n.target.value;i(t.ID,{id:e.ID,value:s?"":r,customValue:s})},fullWidth:!0,children:o})}),(0,n.jsx)(b.Z,{children:null===(r=l.find(t=>t.id===e.ID.toString()))||void 0===r?void 0:r.message})]})},W=e=>{let t=s(e.ID);if(!t)return(0,n.jsx)(n.Fragment,{});let i=e.CustomValue&&t.customValue;return e.Values&&e.Values.length&&!i?V(e):P(e)};return r.useEffect(()=>{let e=t.Fields.filter(e=>e.MultiField),i=a[t.ID];!u.length&&e.length&&i&&i.inputs&&N(Object.keys(i.inputs).filter(t=>e.some(e=>e.ID===Number(t))).map(e=>Number(e)))},[t,a,u,N]),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(g.Z,{container:!0,children:[(0,n.jsx)(g.Z,{size:{xs:10,md:10},children:(0,n.jsx)(S.Z,{variant:"h5",component:"h5",style:{margin:"20px 0 20px 0"},children:t.Name})}),(0,n.jsx)(g.Z,{alignContent:"center",children:(0,n.jsx)(y.Z,{title:"Exportar dados preenchidos para continuar mais tarde",arrow:!0,children:(0,n.jsx)(x.Z,{variant:"outlined",onClick:()=>k(a),endIcon:(0,n.jsx)(E.Z,{}),children:"Exportar"})})})]}),(0,n.jsxs)(g.Z,{container:!0,children:[t.Desc?(0,n.jsx)(g.Z,{size:{xs:12,md:12},sx:{margin:"10px 0 20px 0"},children:(0,n.jsx)(w.Z,{icon:(0,n.jsx)(z.Z,{fontSize:"inherit"}),severity:"warning",children:t.Desc})}):void 0,t.Fields.some(e=>e.MultiField)?(0,n.jsxs)(n.Fragment,{children:[u.map(e=>(0,n.jsx)(g.Z,{size:{xs:12,md:12},sx:{minHeight:"85px"},children:W(e)},e.ID)),(()=>{let e=[],i=new Set(c.filter(e=>!!e.MultiFieldGroup).map(e=>e.MultiFieldGroup));i.size?Array.from(i).map(e=>({name:e,items:c.filter(t=>t.MultiFieldGroup===e)})).forEach(t=>{e.push((0,n.jsx)(D.Z,{style:{backgroundColor:"#e1dbda"},value:t.name,children:t.name},t.name)),e.push(...t.items.map(e=>(0,n.jsx)(D.Z,{value:e.ID,children:e.Name},e.ID)))}):e=c.map(e=>(0,n.jsx)(D.Z,{value:e.ID,children:e.Name},e.ID));let r=e=>{Array.from(i).some(t=>t===e)||p(Number(e))};return(0,n.jsxs)(v.Z,{fullWidth:!0,children:[(0,n.jsx)(f.Z,{id:"combo-multifield-".concat(t.Name),children:"Escolha ..."}),(0,n.jsx)(I.Z,{labelId:"combo-multifield-".concat(t.Name),id:"combo-multifield-".concat(t.Name,"-label"),value:"",onChange:e=>r(e.target.value),fullWidth:!0,children:e})]})})()]}):t.Fields.map(e=>(0,n.jsx)(g.Z,{size:{xs:12,md:12},sx:{minHeight:"85px"},children:W(e)},e.ID))]})]})};var R=i(89869),P=i(89621),V=i(62197),W=i(92856),O=i(16463);let A=e=>{let{onBeforeSend:t,onError:i}=e,{getData:r,inputGroups:s,setResult:l,form:{Disclaimer:a}}=(0,j.P)(e=>e),o=async()=>{let e;t();try{(e=await (0,p.$S)(r()))&&l(e)}catch(e){console.log("error",e)}e&&(0,O.redirect)("result"),i("error")};return(0,n.jsxs)(g.Z,{container:!0,spacing:2,style:{height:"780px"},children:[(0,n.jsxs)(g.Z,{size:{xs:12,md:12},container:!0,alignContent:"center",justifyContent:"center",flexDirection:"column",style:{textAlign:"center"},children:[(0,n.jsx)(S.Z,{gutterBottom:!0,variant:"h5",component:"div",children:"Preenchimento conclu\xeddo"}),(0,n.jsx)(S.Z,{variant:"body2",sx:{color:"text.secondary"},children:a})]}),(0,n.jsxs)(g.Z,{size:{xs:12,md:12},container:!0,justifyContent:"center",alignContent:"flex-start",children:[(0,n.jsx)(y.Z,{title:"Exportar dados preenchidos para continuar mais tarde",arrow:!0,children:(0,n.jsx)(x.Z,{variant:"outlined",onClick:()=>k(s),endIcon:(0,n.jsx)(E.Z,{}),children:"Exportar"})}),(0,n.jsx)(y.Z,{title:"Efectuar os calculos e visualizar os resultados",arrow:!0,children:(0,n.jsx)(x.Z,{variant:"contained",endIcon:(0,n.jsx)(W.Z,{}),onClick:o,size:"large",children:"Calcular"})})]})]})};var B=i(70374),_=i(41573),q=i(84556);let H=(0,i(48024).ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),T=e=>{let{onBegin:t}=e,{form:i,setInputGroups:s}=(0,j.P)(e=>e),[l,a]=r.useState({show:!1}),o=async e=>{let t=await N(e);if(t.errorMessage){a({show:!0,message:t.errorMessage,severity:"error"});return}if(!t.data){a({show:!0,message:"Erro na leitura do ficheiro",severity:"error"});return}s(Object.values(t.data)),a({show:!0,message:"Ficheiro importado com sucesso!"})};return(0,n.jsxs)(g.Z,{container:!0,spacing:2,style:{height:"780px"},children:[(0,n.jsxs)(g.Z,{size:{xs:12,md:12},container:!0,justifyContent:"center",alignContent:"center",style:{textAlign:"center"},children:[(0,n.jsx)(S.Z,{gutterBottom:!0,variant:"h5",component:"div",children:i.Title}),(0,n.jsx)(S.Z,{variant:"body2",sx:{color:"text.secondary"},children:i.Desc})]}),(0,n.jsxs)(g.Z,{size:{xs:12,md:12},container:!0,justifyContent:"center",alignContent:"flex-start",children:[(0,n.jsx)(y.Z,{title:"Importar dados de uma calculadora previamente preenchida",arrow:!0,children:(0,n.jsxs)(x.Z,{variant:"outlined",endIcon:(0,n.jsx)(q.Z,{}),size:"large",component:"label",children:["Importar",(0,n.jsx)(H,{type:"file",onChange:e=>o(e)})]})}),(0,n.jsx)(y.Z,{title:"Iniciar o preenchimento dos dados para a calculadora",arrow:!0,children:(0,n.jsx)(x.Z,{variant:"contained",endIcon:(0,n.jsx)(_.Z,{}),onClick:()=>{t()},size:"large",children:"Iniciar"})})]}),(0,n.jsx)(B.Z,{open:l.show,autoHideDuration:6e3,onClose:()=>a({show:!1}),anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,n.jsx)(w.Z,{onClose:()=>a({show:!1}),severity:l.severity||"success",variant:"filled",sx:{width:"100%"},children:l.message})})]})};var G=i(11276),J=i(40468);let L=e=>{let{message:t}=e;return(0,n.jsx)(V.Z,{maxWidth:"md",children:(0,n.jsx)(g.Z,{container:!0,children:(0,n.jsxs)(g.Z,{size:{xs:12,md:12},sx:{minHeight:"780px"},alignContent:"center",justifyItems:"center",children:[(0,n.jsx)(S.Z,{variant:"h6",children:t||"Aguarde"}),(0,n.jsx)(J.Z,{color:"inherit"})]})})})};var X=i(29482),$=i(81115);let K=e=>{let{message:t,description:i,onRetry:r}=e;return(0,n.jsx)(V.Z,{maxWidth:"md",children:(0,n.jsx)(g.Z,{container:!0,children:(0,n.jsxs)(g.Z,{size:{xs:12,md:12},sx:{minHeight:"780px"},alignContent:"center",justifyItems:"center",children:[(0,n.jsx)($.Z,{sx:{color:"red",width:"50px",height:"50px"}}),(0,n.jsx)(S.Z,{variant:"h5",children:t||"Ocorreu um erro!"}),(0,n.jsx)(S.Z,{variant:"h6",color:"secondary",children:i||"Infelizmente nao fomos capazes de concluir a opera\xe7\xe3o, por favor tente mais tarde."}),r?(0,n.jsx)(x.Z,{variant:"contained",onClick:r,size:"large",sx:{marginTop:"50px"},children:"tentar novamente"}):null]})})})},Q=()=>{let e=(0,O.useSearchParams)().get("id");(0,X.g)(!0);let[t,i]=r.useState({initialStep:0,nextStep:()=>{},previousStep:()=>{},goToStep:e=>{console.log("navigate to step "+e)}}),[l,a]=r.useState(0),{setNextStep:c,setForm:d,form:u,hasErrors:h,routerParam:x,setRouterParam:Z,setInputGroups:v}=(0,j.P)(e=>e),[f,I]=r.useState((0,R.Z)()),[D,b]=r.useState(!1),[y,C]=r.useState(),S=async()=>{let e=l+1;c(e),await h()||(a(e),t.nextStep())},w=(0,r.useCallback)(async()=>{b(!0);let t=u;if(!e&&!t.ID){C({}),b(!1);return}if(!t.ID&&e)try{C(void 0),t=await (0,p.R3)(e),d(t)}catch(e){C({}),b(!1)}I((0,R.Z)((0,G.W)("#".concat(t.Colors[0]),"#".concat(t.Colors[1])))),b(!1)},[e,u,d]),z=()=>u?u.Groups.map(e=>(0,n.jsx)(s,{children:(0,n.jsx)(M,{group:e})},e.ID)):[],F=r.useCallback(async()=>{c(7),await h()||(a(7),t.goToStep(8),Z(""))},[h,c,t,Z]);(0,r.useEffect)(()=>{w()},[w]),(0,r.useEffect)(()=>{"new"===x&&0===l&&(Z(""),v([])),"edit"===x&&0===l&&F()},[l,F,x,d,v,Z]);let k=()=>[(0,n.jsx)(T,{onBegin:S},"initialStep"),...z(),(0,n.jsx)(A,{onBeforeSend:()=>b(!0),onError:N},"finalStep")],N=()=>{b(!1),C({onRetry:()=>{C(void 0),a(0)}})};return(0,n.jsx)(P.Z,{theme:f,defaultMode:"light",children:D?(0,n.jsx)(L,{}):y?(0,n.jsx)(K,{onRetry:y.onRetry}):(0,n.jsx)(V.Z,{maxWidth:"md",children:(0,n.jsxs)(g.Z,{container:!0,children:[(0,n.jsx)(g.Z,{size:{xs:12,md:12},sx:{minHeight:"780px"},children:(0,n.jsx)(o(),{instance:e=>i({...t,...e}),children:k()})}),(0,n.jsx)(g.Z,{size:{xs:12,md:12},children:(0,n.jsx)(m,{activeStep:l,handleBack:()=>{let e=l-1;c(e),a(e),t.previousStep()},handleNext:S,totalSteps:k().length})})]})})})},Y=(0,l.default)(()=>Promise.resolve(Q),{ssr:!1})}},e=>{var t=t=>e(e.s=t);e.O(0,[334,131,36,130,215,744],()=>t(98528)),_N_E=e.O()}]);